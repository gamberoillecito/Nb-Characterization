outdata_prefix "./out/ddb"
ndtset      17 # 16 q-points + DDK calculation

# IO
prtebands   0
prtden      0
prteig      0
prtgsr      0
prtkden     0
prtwf       0
prtpot      0 # we don't use POT files for e-ph coupling

getden_filepath "./save/gs_DEN"
getwfk_filepath "./save/gs_WFK"


#=========================================================================================
# Common data
#=========================================================================================

# Crystal structure
ntypat      1
znucl       41
pseudos     "Nb.psp8"
pp_dirpath  "../pseudos/PBE-FR"
natom       1
typat       1
xred        0 0 0
acell       6.2600834178  6.2600834178  6.2600834178  Bohr
rprim      -0.5 0.5 0.5   0.5 -0.5 0.5   0.5 0.5 -0.5

# k-point grid
kptopt      3           # use whole BZ
ngkpt       18 18 18
nshiftk     1
shiftk      0 0 0       # Use a centered grid 

# Spin-orbit coupling
nsppol      1
nspinor     2
nspden      1

# Electron states
ecut        42 Ha
occopt      4
nband       18
tsmear      0.009 Ha

#=========================================================================================
# General data for all phonon calculations:
#=========================================================================================

nstep       100
tolvrs      1e-10       # tolerance on potential residual

rfphon      1           # calculate response function to q-phonon
rfatpol     1 1         # all atoms are perturbed
rfdir       1 1 1       # all directions of perturbation = reduced x y z

nqpt        1           # 1 q-point at a time
qptopt      1           # option to use irreducible wedge of q-points 
ngqpt       6 6 6       # q-points grid must be sub-grid of k-point grid
nshiftq     1
shiftq      0 0 0       # q-grid must contain the Gamma point


#=========================================================================================
# DATASET 1-16 : phonons on a 6x6x6 q-point grid, saving perturbed densities
#=========================================================================================

iqpt:       1
iqpt+       1


#=========================================================================================
#  DATASET 17 : compute DDK matrix elements
#=========================================================================================

iqpt17      1           # Gamma point (0 0 0)
rfphon17    0           # no response function to phonons
rfelfd17    2           # equivalent to rfddk 1
iscf17     -3           # Need this non-self-consistent option for d/dk 
tolwfr17    1e-18   