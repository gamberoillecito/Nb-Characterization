outdata_prefix "./out/gkk"
ndtset      22

#=========================================================================================
# Common data for GS and perturbation runs
#=========================================================================================

# Crystal structure
ntypat      1
znucl       41
pseudos     "Nb.psp8"
pp_dirpath  "../pseudos/PBE-FR"
natom       1
typat       1
xred        0 0 0
acell       6.2370411016  6.2370411016  6.2370411016  Bohr
rprim      -0.5 0.5 0.5   0.5 -0.5 0.5   0.5 0.5 -0.5

# k-point grid .
ngkpt       28 28 28        
kptopt      3
nshiftk     1
shiftk      0 0 0

# Electron states
ecut        42.0 
nband       26          # include some empty bands to converge the Fermi surface states well
occopt      4           # metallic occupation function (Marzari)
tsmear      0.004       # with a small smearing

# Spin-orbit coupling
nsppol      1
nspinor     2
nspden      1


#=========================================================================================
# General data for all phonon calculations:
#=========================================================================================

nstep       1           # all data is actually taken from output of "ddb.abi"
nline       1
iscf       -2           
tolwfr      1e-18       # tolerance on wavefunction residual

rfphon      1           # calculate response function to q-phonon
rfatpol     1 1         # all atoms are perturbed
rfdir       1 1 1       # all directions of perturbation = reduced x y z

prtgkk      1
prepgkk     1           # flag to calculate all perturbations for el-ph calculations
use_nonscf_gkk 0        # enforce old default and scf-calculate all perturbations

nqpt        1           # 1 q-point at a time
ngqpt       7 7 7       # q-points grid must be sub-grid of k-point grid
nshiftq     1
shiftq      0 0 0       # q-grid must contain the Gamma point
qptopt      1           # option to use irreducible wedge of q-points 

getden      1
getwfk      1
prtwf       0
prtden      0
prteig      0
prtebands   0


#=========================================================================================
# DATASET 1 : extend WF on full BZ
#=========================================================================================

getden_filepath1    "./out/gs_DEN"
getwfk_filepath1    "./out/gs_WFK"

getwfk1     0
getden1     0
prtwf1      1
prtden1     1
prtdkk1     0

iscf1       7           # SCF procedure (Pulay, i.e. default)
rfphon1     0           # no response function to phonons
nqpt1       0           # no q-points


#=========================================================================================
# DATASET 2-21 : phonons on a 7x7x7 q-point grid, saving perturbed densities
#=========================================================================================

iqpt2   1     getddb_filepath2   "./out/ddb_DS1_DDB"
iqpt3   2     getddb_filepath3   "./out/ddb_DS2_DDB"
iqpt4   3     getddb_filepath4   "./out/ddb_DS3_DDB"
iqpt5   4     getddb_filepath5   "./out/ddb_DS4_DDB"
iqpt6   5     getddb_filepath6   "./out/ddb_DS5_DDB"
iqpt7   6     getddb_filepath7   "./out/ddb_DS6_DDB"
iqpt8   7     getddb_filepath8   "./out/ddb_DS7_DDB"
iqpt9   8     getddb_filepath9   "./out/ddb_DS8_DDB"
iqpt10  9     getddb_filepath10  "./out/ddb_DS9_DDB"
iqpt11  10    getddb_filepath11  "./out/ddb_DS10_DDB"
iqpt12  11    getddb_filepath12  "./out/ddb_DS11_DDB"
iqpt13  12    getddb_filepath13  "./out/ddb_DS12_DDB"
iqpt14  13    getddb_filepath14  "./out/ddb_DS13_DDB"
iqpt15  14    getddb_filepath15  "./out/ddb_DS14_DDB"
iqpt16  15    getddb_filepath16  "./out/ddb_DS15_DDB"
iqpt17  16    getddb_filepath17  "./out/ddb_DS16_DDB"
iqpt18  17    getddb_filepath18  "./out/ddb_DS17_DDB"
iqpt19  18    getddb_filepath19  "./out/ddb_DS18_DDB"
iqpt20  19    getddb_filepath20  "./out/ddb_DS19_DDB"
iqpt21  20    getddb_filepath21  "./out/ddb_DS20_DDB"


#=========================================================================================
# DATASET 22 : computes DDK matrix elements on the full grid
#=========================================================================================

rfphon22    0           # no response function to phonons
rfelfd22    2           # Activate the calculation of the d/dk perturbation
iqpt22      1           # This is a calculation at the Gamma point
iscf22     -3           # The d/dk perturbation must be treated non SC-ly
getddb_filepath22 "./out/ddb_DS1_DDB"