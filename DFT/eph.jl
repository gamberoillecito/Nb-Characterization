using JSON
using Scanf

eV_in_Ha = 27.211396641308;

function skiplines(io::IO, n::Int)
    for _ ∈ 1:n
        skipchars(c -> c != '\n', io)
        read(io, Char) # actually skip the newline
    end
end

function load_a2f(filename, cols)
    f = open(filename, "r")
    skiplines(f, 5)
    _, N = @scanf(f, "#  number of energy points : %d", Int32)
    E = Vector{Float64}(undef, N)
    a2f = Matrix{Float64}(undef, N, cols)
    skiplines(f, 5)
    for i ∈ 1:N
        _, E[i] = @scanf(f, " %f", Float64)
        for j ∈ 1:cols
            _, a2f[i, j] = @scanf(f, " %f", Float64)
        end
    end
    E *= eV_in_Ha * 1e3
    close(f)
    return (E, a2f)
end

(th_E, th_a2f) = load_a2f("DFT/data/A2F.dat", 1);
(tr_E, tr_a2f) = load_a2f("DFT/data/A2F_TR.dat", 9);

(th_E12, th_a2f12) = load_a2f("DFT/data/A2F12.dat", 1);
(tr_E12, tr_a2f12) = load_a2f("DFT/data/A2F_TR12.dat", 9);

begin
    exp_a2f = [
        0.004191616766467066, 0.006437125748503081, 0.009431137724550953, 0.012425149700598825, 0.015419161676646698, 0.019161676646706538, 0.02290419161676649, 0.02664670658682633, 0.03038922155688628, 0.03488023952095809, 0.03862275449101793, 0.04236526946107788, 0.04610778443113783, 0.05059880239520953, 0.05583832335329342, 0.06032934131736534, 0.06556886227544911, 0.07005988023952103, 0.07380239520958076, 0.08203592814371263, 0.08652694610778444, 0.08952095808383231, 0.09401197604790423, 0.09775449101796407, 0.10299401197604796, 0.1089820359281437, 0.11347305389221551, 0.11946107784431137, 0.1261976047904192, 0.13218562874251494, 0.13892215568862276, 0.14341317365269468, 0.14940119760479043, 0.15389221556886223, 0.15913173652694612, 0.16437125748503, 0.16886227544910182, 0.17335329341317374, 0.17934131736526948, 0.1838323353293413, 0.18907185628742518, 0.19431137724550895, 0.19880239520958076, 0.2025449101796407, 0.2077844311377245, 0.2122754491017964, 0.21676646706586822, 0.22275449101796402, 0.2279940119760479, 0.23323353293413174, 0.23997005988023956, 0.2474550898203593, 0.25494011976047903, 0.2616766467065868, 0.2684131736526946, 0.2736526946107784, 0.2811377245508982, 0.28787425149700596, 0.29535928143712575, 0.3028443113772455, 0.3103293413173652, 0.31706586826347305, 0.32529940119760475, 0.33502994011976045, 0.34476047904191615, 0.3529940119760479, 0.3619760479041916, 0.37245508982035924, 0.381437125748503, 0.39116766467065867, 0.40164670658682633, 0.412125748502994, 0.4226047904191617, 0.43233532934131735, 0.443562874251497, 0.4547904191616766, 0.4652694610778443, 0.47799401197604785, 0.48997005988023945, 0.5004491017964072, 0.5139221556886228, 0.5236526946107785, 0.533383233532934, 0.5446107784431138, 0.5573353293413174, 0.569311377245509, 0.5790419161676646, 0.5910179640718562, 0.6014970059880239, 0.6119760479041916, 0.6217065868263473, 0.6291916167664671, 0.6359281437125748, 0.6381736526946108, 0.6359281437125748, 0.631437125748503, 0.6261976047904192, 0.6209580838323353, 0.6149700598802395, 0.6097305389221557, 0.600748502994012, 0.5910179640718562, 0.5820359281437125, 0.5715568862275449, 0.5595808383233533, 0.5498502994011976, 0.5423652694610779, 0.5318862275449101, 0.5236526946107785, 0.5139221556886228, 0.5041916167664671, 0.4937125748502994, 0.48173652694610775, 0.4697604790419162, 0.4607784431137724, 0.45029940119760475, 0.43832335329341315, 0.4293413173652694, 0.41661676646706586, 0.4061377245508982, 0.3986526946107784, 0.3934131736526946, 0.38967065868263473, 0.38293413173652696, 0.3776946107784431, 0.37245508982035924, 0.3657185628742515, 0.3597305389221557, 0.35449101796407184, 0.35224550898203594, 0.350748502994012, 0.3477544910179641, 0.34476047904191615, 0.3432634730538922, 0.3455089820359281, 0.34700598802395205, 0.34700598802395205, 0.3455089820359281, 0.3440119760479042, 0.3417664670658683, 0.34251497005988024, 0.34476047904191615, 0.3477544910179641, 0.350748502994012, 0.35449101796407184, 0.35823353293413174, 0.3619760479041916, 0.36646706586826344, 0.3717065868263473, 0.3754491017964072, 0.381437125748503, 0.3874251497005988, 0.3934131736526946, 0.3986526946107784, 0.40314371257485027, 0.40913173652694607, 0.41511976047904187, 0.4218562874251497, 0.4278443113772455, 0.4330838323353293, 0.4375748502994012, 0.44206586826347305, 0.4458083832335329, 0.44805389221556885, 0.44805389221556885, 0.4458083832335329, 0.442814371257485, 0.4398203592814371, 0.4353293413173652, 0.4293413173652694, 0.42485029940119756, 0.42035928143712575, 0.4158682634730539, 0.411377245508982, 0.4061377245508982, 0.40089820359281436, 0.39416167664670654, 0.38892215568862276, 0.38368263473053893, 0.37694610778443116, 0.3694610778443113, 0.3619760479041916, 0.3552395209580838, 0.34700598802395205, 0.3395209580838323, 0.3297904191616767, 0.31931137724550895, 0.31107784431137725, 0.30134730538922155, 0.29386227544910176, 0.2841317365269461, 0.27589820359281436, 0.2684131736526946, 0.2594311377245509, 0.2526946107784431, 0.24520958083832334, 0.23547904191616764, 0.2279940119760479, 0.2197604790419161, 0.2100299401197605, 0.20329341317365268, 0.19431137724550895, 0.1838323353293413, 0.1741017964071856, 0.16736526946107788, 0.16062874251497006, 0.1523952095808384, 0.14341317365269468, 0.1381736526946108, 0.130688622754491, 0.12395209580838329, 0.11721556886227547, 0.10973053892215578, 0.10374251497005993, 0.0970059880239521, 0.09026946107784428, 0.08203592814371263, 0.07604790419161678, 0.06931137724550895, 0.06482035928143715, 0.057335329341317354, 0.05134730538922161, 0.045359281437125754, 0.03787425149700596, 0.02664670658682633, 0.01841317365269468, 0.012425149700598825, 0.004940119760479034,
    ]
    exp_E = [
        1.161290322580645, 1.4562211981566815, 1.677419354838709, 1.935483870967742, 2.1566820276497687, 2.4147465437788016, 2.635944700460829, 2.8202764976958514, 3.041474654377881, 3.2626728110599084, 3.4470046082949306, 3.6313364055299537, 3.7788018433179724, 3.9631336405529956, 4.147465437788018, 4.331797235023041, 4.516129032258064, 4.663594470046083, 4.8110599078341005, 5.069124423963133, 5.400921658986176, 5.622119815668203, 5.8433179723502295, 6.064516129032258, 6.285714285714285, 6.506912442396313, 6.72811059907834, 6.949308755760368, 7.2073732718894, 7.465437788018432, 7.76036866359447, 7.981566820276498, 8.23963133640553, 8.423963133640553, 8.645161290322578, 8.903225806451612, 9.087557603686637, 9.308755760368664, 9.566820276497696, 9.788018433179722, 10.009216589861751, 10.267281105990783, 10.488479262672811, 10.709677419354838, 11.004608294930875, 11.188940092165899, 11.373271889400922, 11.594470046082948, 11.778801843317973, 11.852534562211982, 12.0, 12.14746543778802, 12.258064516129032, 12.40552995391705, 12.479262672811059, 12.589861751152073, 12.663594470046084, 12.774193548387096, 12.88479262672811, 12.95852534562212, 13.069124423963132, 13.179723502304148, 13.253456221198155, 13.364055299539173, 13.43778801843318, 13.51152073732719, 13.622119815668201, 13.695852534562212, 13.769585253456219, 13.880184331797237, 13.91705069124424, 13.990783410138247, 14.064516129032258, 14.138248847926265, 14.211981566820276, 14.285714285714286, 14.359447004608294, 14.433179723502304, 14.506912442396311, 14.580645161290322, 14.65437788018433, 14.72811059907834, 14.764976958525347, 14.838709677419354, 14.912442396313365, 15.023041474654375, 15.096774193548386, 15.170506912442393, 15.2073732718894, 15.281105990783411, 15.354838709677418, 15.465437788018432, 15.576036866359447, 15.723502304147464, 15.90783410138249, 15.944700460829493, 15.9815668202765, 16.055299539170505, 16.055299539170505, 16.09216589861751, 16.09216589861751, 16.12903225806452, 16.165898617511523, 16.202764976958527, 16.202764976958527, 16.23963133640553, 16.276497695852534, 16.313364055299537, 16.35023041474654, 16.35023041474654, 16.387096774193544, 16.423963133640555, 16.46082949308756, 16.497695852534562, 16.534562211981566, 16.57142857142857, 16.57142857142857, 16.645161290322584, 16.645161290322584, 16.71889400921659, 16.792626728110598, 16.866359447004605, 16.94009216589862, 17.087557603686633, 17.19815668202765, 17.27188940092166, 17.308755760368662, 17.382488479262676, 17.52995391705069, 17.75115207373272, 17.972350230414747, 18.11981566820276, 18.193548387096776, 18.414746543778804, 18.599078341013822, 18.783410138248847, 19.004608294930875, 19.1889400921659, 19.373271889400918, 19.557603686635943, 19.77880184331797, 20.0, 20.22119815668202, 20.33179723502304, 20.516129032258064, 20.70046082949309, 20.847926267281103, 20.995391705069125, 21.14285714285714, 21.253456221198157, 21.400921658986178, 21.548387096774192, 21.6221198156682, 21.76958525345622, 21.843317972350235, 21.953917050691246, 22.064516129032256, 22.175115207373267, 22.285714285714285, 22.32258064516129, 22.396313364055302, 22.470046082949303, 22.543778801843317, 22.764976958525345, 22.94930875576037, 23.096774193548384, 23.207373271889402, 23.28110599078341, 23.317972350230413, 23.354838709677423, 23.354838709677423, 23.354838709677423, 23.39170506912442, 23.42857142857143, 23.502304147465438, 23.53917050691244, 23.576036866359445, 23.576036866359445, 23.64976958525346, 23.686635944700456, 23.723502304147466, 23.76036866359447, 23.797235023041473, 23.87096774193548, 23.90783410138249, 23.944700460829495, 23.981566820276498, 24.018433179723502, 24.055299539170505, 24.092165898617516, 24.165898617511516, 24.202764976958527, 24.23963133640553, 24.23963133640553, 24.276497695852534, 24.313364055299537, 24.35023041474654, 24.38709677419355, 24.423963133640548, 24.46082949308756, 24.534562211981566, 24.534562211981566, 24.57142857142857, 24.645161290322584, 24.718894009216584, 24.792626728110598, 24.90322580645161, 25.013824884792626, 25.161290322580648, 25.38248847926267, 25.52995391705069, 25.714285714285715, 25.86175115207373, 26.00921658986175, 26.11981566820276, 26.23041474654378, 26.341013824884797, 26.451612903225808, 26.48847926267281, 26.56221198156682, 26.635944700460833, 26.70967741935484, 26.783410138248847, 26.857142857142854, 26.894009216589865, 26.93087557603687, 26.967741935483865, 27.004608294930875
    ]
end

begin
    d = Dict(
        "experiment" => Dict(
            "energy" => exp_E,
            "a2f" => exp_a2f
        ),
        "k18_q6" => Dict(
            "thermodynamic" => Dict(
                "energy" => th_E,
                "a2f" => th_a2f[:, 1]
            ),
            "transport" => Dict(
                "energy" => tr_E,
                "a2f" => tr_a2f[:, 1]
            )
        ),
        "k12_q12" => Dict(
            "thermodynamic" => Dict(
                "energy" => th_E12,
                "a2f" => th_a2f12[:, 1]
            ),
            "transport" => Dict(
                "energy" => tr_E12,
                "a2f" => tr_a2f12[:, 1]
            )
        ),
    )
    open("DFT/export/a2f.json", "w") do f
        JSON.print(f, d)
    end
end
